  stages:
    - build

  build-image-docker:
    stage: build
    tags:
      - build
    image: docker:latest
    services:
      - docker:dind
    before_script:
      - docker info
      - 'echo $CI_REGISTRY_PASSWORD | docker login -u $CI_REGISTRY_USER --password-stdin'
    script:
      - docker build -t adrianmanuel/spvending-manager:$CI_COMMIT_TAG .
      - docker push adrianmanuel/spvending-manager:$CI_COMMIT_TAG
    rules:
      - if: '$CI_COMMIT_TAG != "" && $CI_COMMIT_BRANCH == "main"'